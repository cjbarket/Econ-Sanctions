---
title: "Financial"
format: html
editor: visual
---

## Scraping Function

```{'''{r}
#|: function-to-scrape-tabular-financial-data-from-yahoo-finance
# returns a df that is ready for analysis
# url: Yahoo Finance URL to scrape
# file: name the resulting df will be saved as

scrape_yahoo <- function(url, file) {
  scrape(url, file)
  df <- read_csv(
    file.path(
      dirname(getwd()),
      "data",
      file
    )
  )
  df <- df[-c(1)]
  df <- df |>
    dplyr::rename(
      Month = 1,
      Day = 2, 
      Year = 3, 
      Open = 4,
      High = 5,
      Low = 6,
      Close = 7,
      Adj_Close = 8,
      Volume = 9
    )
  df <- df |> 
  mutate(
    Date = paste(Month, Day, Year, sep = " "),
    Date = ymd(as.Date(anydate(Date)))
  ) |> 
  select(Date, Open, High, Low, Close, Adj_Close, Volume)
  years <- as.vector(df$Date)
  years <- as.Date(anydate(df$Date))
  years <- year(years)
  years <- unique(years)
  min_year <- as.double(min(years))
  max_year <- as.double(max(years))
  print(paste0("Returning data for years ", min_year, " to ", max_year))
  return(df)
}
```

## Querying Function (Alternative)

```{'''{r}
#|: function-to-query-data-from-Yahoo-Finance
# uses yfinance Python package to quickly and easily query data from Yahoo Finance
# loops through all tickers defined in yfin.py and saves historical data for each to data folder
# resulting file names follow the form "ticker_[ticker_symbol].csv"
# for documentation on each ticker (i.e., to see which index corresponds to each ticker), see https://finance.yahoo.com/world-indices/

query_yahoo()
```

## Africa

```{'''{r}
#|: South-Africa

url = 'https://finance.yahoo.com/quote/%5EJN0U.JO/history?period1=1506384000&period2=1696291200&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "south_africa.csv"
south_africa <- scrape_yahoo(url, file)
```

## Asia

```{'''{r}
#|: Iran
# TSE (Tehran Stock Exchange)
# uses its own  function (defined in iran.py) to scrape https://tsetmc.com/IndexInfo/32097828799138957 (website for TSE)

scrape_iran("iran_financials.csv")
iran <- read_csv("../data/iran_financials.csv")
view(iran)
```

```{'''{r}
#|: China
# CSI 300

url = 'https://finance.yahoo.com/quote/000300.SS/history?period1=1615334400&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "china.csv"
china <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Hong-Kong
# Hang Seng Index

url = 'https://finance.yahoo.com/quote/%5EHSI/history?period1=536284800&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "hong_kong.csv"
hong_kong <- scrape_yahoo(url, file)
```

```{'''{r}
#|: India
# NIFTY 50

url = 'https://finance.yahoo.com/quote/%5ENSEI/history?period1=1189900800&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "india.csv"
india <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Indonesia
# JKSE

url = 'https://finance.yahoo.com/quote/%5EJKSE/history?period1=639273600&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "indonesia.csv"
indonesia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Israel
# TA-125

url = 'https://finance.yahoo.com/quote/%5ETA125.TA/history?period1=718502400&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "israel.csv"
israel <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Japan
# Nikkei 225

url = 'https://finance.yahoo.com/quote/%5EN225/history?period1=-157507200&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "japan.csv"
japan <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Malaysia
# FTSE Bursa Malaysia

url = 'https://finance.yahoo.com/quote/%5EKLSE%3B1%3D9/history?period1=754790400&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "malaysia.csv"
malaysia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Philippines 
# PSEi

url = 'https://finance.yahoo.com/quote/PSEI.PS/history?period1=536457600&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "philippines.csv"
philippines <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Saudi-Arabia
# Tadawul

url = 'https://finance.yahoo.com/quote/%5ETASI.SR/history?period1=908755200&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "saudi_arabia.csv"
saudi_arabia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Korea
# KOSDAQ

url = 'https://finance.yahoo.com/quote/%5EKQ11/history?period1=971568000&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "korea.csv"
korea <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Taiwan
# TWII

url = 'https://finance.yahoo.com/quote/%5ETWII/history?period1=867715200&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "taiwan.csv"
taiwan <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Thailand
# SET Index

url = 'https://finance.yahoo.com/quote/%5ESET.BK/history?period1=850176000&period2=1693526400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "thailand.csv"
thailand <- scrape_yahoo(url, file)
```

## Europe

```{'''{r}
#|: Austria
# FTX

url = 'https://finance.yahoo.com/quote/%5EATX/history?period1=721440000&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "austria.csv"
austria <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Belgium
# BEL 20

url = 'https://finance.yahoo.com/quote/%5EBFX/history?period1=671155200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "belgium.csv"
belgium <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Bulgaria
# SOFIX ETF

url = 'https://nz.finance.yahoo.com/quote/BGX.L/history?period1=1538352000&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "bulgaria.csv"
bulgaria <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Croatia
# CROBEX ETF

url = 'https://ca.finance.yahoo.com/quote/ECDC.DE/history?period1=1523836800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "croatia.csv"
croatia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Denmark
# OMXC25

url = 'https://finance.yahoo.com/quote/%5EOMXC25/history?period1=1482105600&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "denmark.csv"
denmark <- scrape_yahoo(url, file)
```

```{'''{r}
#|: England
# LSE

url = 'https://finance.yahoo.com/quote/LSEG.L/history?period1=995587200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "england.csv"
england <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Finland
# OMXH25

url = 'https://finance.yahoo.com/quote/%5EOMXH25/history?period1=1362441600&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "finland.csv"
finland <- scrape_yahoo(url, file)
```

```{'''{r}
#|: France
# CAC 40

# new way of webscraping (using selenium)
url = 'https://finance.yahoo.com/quote/%5EFCHI/history?period1=636249600&period2=1689206400&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "france.csv"
france <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Germany
# DAX

url = 'https://finance.yahoo.com/quote/%5EGDAXI/history?period1=567820800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "germany.csv"
germany <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Greece
# Composite Index

url = 'https://finance.yahoo.com/quote/GD.AT/history?period1=867715200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "greece.csv"
greece <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Ireland
# ISEQ

url = 'https://finance.yahoo.com/quote/%5EISEQ/history?period1=868492800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "ireland.csv"
ireland <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Lithuania
# OMX Vilnius GI

url = 'https://finance.yahoo.com/quote/%5EOMXVGI/history?period1=1367280000&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "lithuania.csv"
lithuania <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Netherlands
# AEX Index

url = 'https://finance.yahoo.com/quote/%5EAEX/history?period1=718848000&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "netherlands.csv"
netherlands <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Norway
# OBX

url = 'https://finance.yahoo.com/quote/OBX.OL/history?period1=1096243200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "norway.csv"
norway <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Portugal
# PSI

url = 'https://finance.yahoo.com/quote/PSI20.LS/history?period1=1367280000&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "portugal.csv"
portugal <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Russia
# MOEX

url = 'https://finance.yahoo.com/quote/IMOEX.ME/history?period1=1362441600&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "russia.csv"
russia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Serbia
# BELEX 15 ETF

url = 'https://finance.yahoo.com/quote/ESNB.DE/history?period1=1523836800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "serbia.csv"
serbia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Slovakia
# SAX ETF

url = 'https://finance.yahoo.com/quote/SK9A.F/history?period1=1523836800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "slovakia.csv"
slovakia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Spain
# IBEX 35

url = 'https://finance.yahoo.com/quote/%5EIBEX/history?period1=742435200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "spain.csv"
spain <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Sweden
# OMX Stockholm 30

url = 'https://finance.yahoo.com/quote/%5EOMX/history?period1=1227139200&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "sweden.csv"
sweden <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Switzerland
# SSMI

url = 'https://finance.yahoo.com/quote/%5ESSMI/history?period1=658108800&period2=1694476800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "switzerland.csv"
switzerland <- scrape_yahoo(url, file)
```

## Oceania

```{'''{r}
#|: Australia
# S&P/ASX 300

url = 'https://finance.yahoo.com/quote/%5EAXKO/history?period1=1362441600&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "australia.csv"
australia <- scrape_yahoo(url, file)
```

```{'''{r}
#|: New-Zealand
# NZX 50

url = 'https://finance.yahoo.com/quote/%5ENZ50/history?period1=1041465600&period2=1693612800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "new_zealand.csv"
new_zealand <- scrape_yahoo(url, file)
```

## Americas

```{'''{r}
#|: Argentina
# MERVAL

url = 'https://finance.yahoo.com/quote/%5EMERV/history?period1=844732800&period2=1694044800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "argentina.csv"
argentina <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Brazil 
# IBOVESPA

url = 'https://finance.yahoo.com/quote/%5EBVSP/history?period1=735868800&period2=1694044800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "brazil.csv"
brazil <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Canada
# S&P/TSX Composite

url = 'https://finance.yahoo.com/quote/%5EGSPTSE/history?period1=299462400&period2=1694044800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "canada.csv"
canada <- scrape_yahoo(url, file)
```

```{'''{r}
#|: Mexico
# IPC Mexico

url = 'https://finance.yahoo.com/quote/%5EMXX/history?period1=689558400&period2=1694044800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "mexico.csv"
mexico <- scrape_yahoo(url, file)
```

```{'''{r}
#|: United States
# S&P 500

url = 'https://finance.yahoo.com/quote/%5EGSPC/history?period1=-1325635200&period2=1694044800&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true'
file = "usa.csv"
usa <- scrape_yahoo(url, file)
```

## Other

```{'''{r}
#|: example-of-old-way-of-webscraping
# France's CAC 40

# old way of webscraping
# france <- read_html("https://finance.yahoo.com/quote/%5EFCHI/history?period1=636249600&period2=1689033600&interval=1d&filter=history&frequency=1d&includeAdjustedClose=true") |> 
#   html_table(fill = TRUE)
# view(france)
```

```{'''{r}
#|: testing-investing.com

# url <- "https://www.investing.com/indices/dhaka-stock-exchange-30-historical-data"
# table <- read_html(url) |> html_table(fill = TRUE)
# table <- as.data.frame(table[1]) |> select(Date, Price, Open, High, Low)
# view(table)
```
